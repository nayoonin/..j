;-------------------------------------------------
;ダンジョンで発生するフロアイベントを抽選して1つ返す関数
;ダンジョン番号が見つからないならコモン関数を呼ぶ
;DIDにダンジョンの定義番号、STEPに対象となる階を受け取る
;-------------------------------------------------
@DUNG_FE_CHUSEN(DID = -1 , STEP)
#DIM DID
#DIM STEP
TRYCCALLFORM DUNGEON_{DID}_FE(STEP)

CATCH
	;ダンジョン個別のフロアイベント定義関数がなければ汎用処理
	CALL DUNG_FE_COMMON
ENDCATCH
RETURN RESULT


;-------------------------------------------------
;ダンジョンで発生するフロアイベントを抽選して返す関数
;ダンジョンに固有のイベントパターンが存在しないものはここ
;-------------------------------------------------
@DUNG_FE_COMMON
#DIM EV
SELECTCASE CHUSEN(3 , 25 , 5 , 15 , 52)
	CASE 0
		;レア敵。3%
		EV = 4
	CASE 1
		;通常敵。20%
		EV = 3
	CASE 2
		;人材絡み。8%
		EV = 1
	CASE 3
		;アイテム入手。15%
		EV = 2
	CASE 4
		;その他。何も起きない
		EV = -1
	CASEELSE
		;予期しない数が返されても気づかない恐れがあるのでエラー落ち
		THROW 予期しない分岐
ENDSELECT
RETURN EV
